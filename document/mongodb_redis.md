数据库结构文档
=====================================

MongoDB
-----------------------------------

### gdaeimage

> 存放用户上传图片，主要为身份验证图片


#### 表设计

- fs.files

    > 存放文件概要信息

        {
          "_id": ObjectId("5a6fd9427e403dff39d82c5c"),
          "filename": "ff36adf7-816d-4436-820e-82acb8321fab",
          "aliases": null,
          "chunkSize": NumberLong(261120),
          "uploadDate": ISODate("2018-01-30T02:32:34.705Z"),
          "length": NumberLong(518929),
          "contentType": "image/jpeg",
          "md5": "cd8c02ac9fa482c6bcc5953ddb6b3d80"
        }

    |字段名          |  描述                                      |
    | :-----         | :-----                                    |
    |_id             | 文件唯一标识（获取fs.chunks中的具体文件）    |
    |contentType     | 文件类型                                   |
    |md5             | 文件编码(程序传入编码获取文件概要信息)      |

- fs.chunks

    > 存放具体文件

        {
          "_id": ObjectId("599196e16943401f4f6010e9"),
          "files_id": ObjectId("5a6fd9427e403dff39d82c5c"),
          "n": Int32(0),
          "data": Binary('')
        }
        {
          "_id": ObjectId("5992c5c76943403ed5012d0c"),
          "files_id": ObjectId("5a6fd9427e403dff39d82c5c"),
          "n": Int32(1),
          "data": Binary('')
        }

    |字段名          |  描述                                      |
    | :-----         | :-----                                    |
    |files_id        | fs.files中的 _id                           |
    |n               | 第几个                                     |
    |data            | 文件流                                     |
    

### ctelog

#### 表设计

- C2C_errorlog

- manager_errorlog

- market_errorlog

- trades_errorlog

    > 主要存放异常日志信息

        {
          "_id": ObjectId("5ad9f2d9ef4f329b588cfcfe"),
          "level": "ERROR",
          "loggerName": "com.gop.c2c.service.impl.C2cSellAdvertisementServiceImpl",
          "message": "error_message",
          "source": {
            "className": "com.gop.c2c.service.impl.C2cSellAdvertisementServiceImpl",
            "methodName": "deployC2cSellAdvertisementByUid",
            "fileName": "C2cSellAdvertisementServiceImpl.java",
            "lineNumber": 176
          },
          "marker": null,
          "threadId": NumberLong(84),
          "threadName": "XNIO-2 task-19",
          "threadPriority": 5,
          "millis": NumberLong("1524232921910"),
          "date": ISODate("2018-04-20T14:02:01.910Z"),
          "thrown": {
            "type": "org.springframework.dao.DataIntegrityViolationException",
            "message": "msg",
            "stackTrace": [
              {
                "className": "java.util.concurrent.ThreadPoolExecutor$Worker",
                "methodName": "run",
                "fileName": "ThreadPoolExecutor.java",
                "lineNumber": 624
              },
              {
                "className": "java.lang.Thread",
                "methodName": "run",
                "fileName": "Thread.java",
                "lineNumber": 748
              }
            ],
            "cause": {
              "type": "java.sql.SQLException",
              "message": "Data truncated for column 'category' at row 1",
              "stackTrace": [
                {
                  "className": "java.util.concurrent.ThreadPoolExecutor$Worker",
                  "methodName": "run",
                  "fileName": "ThreadPoolExecutor.java",
                  "lineNumber": 624
                },
                {
                  "className": "java.lang.Thread",
                  "methodName": "run",
                  "fileName": "Thread.java",
                  "lineNumber": 748
                }
              ]
            }
          },
          "contextMap": {},
          "contextStack": []
        }






### gdaetrade

> 存放撮合引擎绘制的K线数据 

#### 表设计

表名规则为： *计价币种*_*交易币种*：*时间*

- BTC_ACT:MIN1

    > 分钟线

- BTC_ACT:MIN5

    > 5分钟线

- BTC_ACT:MIN15

    > 15分钟线

- BTC_ACT:MIN30

    > 30分钟线

- BTC_ACT:MIN60

    > 时线

- BTC_ACT:DAY

    > 日线

        {
          "_id": ObjectId("5a9fb83e8508f0f4838e7a47"),
          "_class": "com.gop.exchange.model.KlineRecord",
          "time": NumberLong(1513612800),
          "klineType": "MIN1",
          "symbol": "BTC_ACT",
          "open": "0.00000255",
          "close": "0.00000255",
          "maxPrice": "0.00000255",
          "lowPrice": "0.00000255",
          "amount": "15"
        }

    |字段名       |  描述                                      |
    | :-----      | :-----                                    |
    |time         | k线时间                                    |
    |klineType    | K线类型：分钟线，5分钟线                    |
    |symbol       | 交易对                                     |
    |open         | 开盘价                                     |
    |close        | 收盘价                                     |
    |maxPrice     | 最高价                                     |
    |lowPrice     | 最低价                                     |
    |amount       | 数量                                     |



Reids
------------------------------------------

- 邮箱验证码

    key: <账号>:code

    类型： string        

        > get 1524243842218:code
        123456        

- 校验Google验证码

    key: ManagerGoogleAuthenticator:<手机号>
    
    类型： string

        > get ManagerGoogleAuthenticator:18600010001
        123456

- 深度数据

    key: <计价币种>_<交易币种>:depth
    
    类型： hash

        > hgetall BTC_ACT:depth
        1) "depths"
        2) "[[[0.00003024000000000000,3848.00000000000000000000,3848.00000000000000000000],[0.00003022000000000000,3853.00000000000000000000,5.00000000000000000000],[0.00003021000000000000,4479.00000000000000000000,626.00000000000000000000],[0.00003010000000000000,4741.00000000000000000000,262.00000000000000000000],[0.00003006000000000000,5004.00000000000000000000,263.00000000000000000000],[0.00003000000000000000,5744.00000000000000000000,740.00000000000000000000],[0.00002987000000000000,5805.00000000000000000000,61.00000000000000000000],[0.00002961000000000000,7188.00000000000000000000,1383.00000000000000000000],[0.00002960000000000000,7306.00000000000000000000,118.00000000000000000000],[0.00002900000000000000,8666.00000000000000000000,1360.00000000000000000000],[0.00002898000000000000,9357.00000000000000000000,691.00000000000000000000],[0.00002852000000000000,9984.00000000000000000000,627.00000000000000000000],[0.00002850000000000000,10158.00000000000000000000,174.00000000000000000000],[0.00002810000000000000,10281.00000000000000000000,123.00000000000000000000],[0.00002770000000000000,10774.00000000000000000000,493.00000000000000000000],[0.00002756000000000000,12012.00000000000000000000,1238.00000000000000000000],[0.00002700000000000000,12013.00000000000000000000,1.00000000000000000000],[0.00002673000000000000,12014.00000000000000000000,1.00000000000000000000],[0.00002660000000000000,12258.00000000000000000000,244.00000000000000000000],[0.00002601000000000000,12259.00000000000000000000,1.00000000000000000000],[0.00002600000000000000,12260.00000000000000000000,1.00000000000000000000],[0.00002545000000000000,12261.00000000000000000000,1.00000000000000000000],[0.00002538000000000000,12422.00000000000000000000,161.00000000000000000000],[0.00002513000000000000,12424.00000000000000000000,2.00000000000000000000],[0.00002501000000000000,12444.00000000000000000000,20.00000000000000000000],[0.00002500000000000000,12492.00000000000000000000,48.00000000000000000000],[0.00002400000000000000,12499.00000000000000000000,7.00000000000000000000],[0.00002356000000000000,13232.00000000000000000000,733.00000000000000000000],[0.00002333000000000000,13233.00000000000000000000,1.00000000000000000000],[0.00002331000000000000,13253.00000000000000000000,20.00000000000000000000],[0.00002323000000000000,13259.00000000000000000000,6.00000000000000000000],[0.00002300000000000000,13360.00000000000000000000,101.00000000000000000000],[0.00002295000000000000,13370.00000000000000000000,10.00000000000000000000],[0.00002270000000000000,13407.00000000000000000000,37.00000000000000000000],[0.00002206000000000000,13408.00000000000000000000,1.00000000000000000000],[0.00002201000000000000,13410.00000000000000000000,2.00000000000000000000],[0.00002200000000000000,13411.00000000000000000000,1.00000000000000000000],[0.00002196000000000000,13468.00000000000000000000,57.00000000000000000000],[0.00002170000000000000,14048.00000000000000000000,580.00000000000000000000],[0.00002144000000000000,14049.00000000000000000000,1.00000000000000000000],[0.00002100000000000000,14083.00000000000000000000,34.00000000000000000000],[0.00002062000000000000,14317.00000000000000000000,234.00000000000000000000]],[[0.00003111000000000000,87.00000000000000000000,87.00000000000000000000],[0.00003112000000000000,176.00000000000000000000,89.00000000000000000000],[0.00003114000000000000,1924.00000000000000000000,1748.00000000000000000000],[0.00003115000000000000,1952.00000000000000000000,28.00000000000000000000],[0.00003127000000000000,1954.00000000000000000000,2.00000000000000000000],[0.00003160000000000000,1964.00000000000000000000,10.00000000000000000000],[0.00003170000000000000,1975.00000000000000000000,11.00000000000000000000],[0.00003250000000000000,4829.00000000000000000000,2854.00000000000000000000],[0.00003278000000000000,5149.00000000000000000000,320.00000000000000000000],[0.00003300000000000000,5175.00000000000000000000,26.00000000000000000000],[0.00003310000000000000,5854.00000000000000000000,679.00000000000000000000],[0.00003399000000000000,5859.00000000000000000000,5.00000000000000000000],[0.00003415000000000000,6024.00000000000000000000,165.00000000000000000000],[0.00003449000000000000,6066.00000000000000000000,42.00000000000000000000],[0.00003450000000000000,6243.00000000000000000000,177.00000000000000000000],[0.00003492000000000000,7388.00000000000000000000,1145.00000000000000000000],[0.00003500000000000000,7653.00000000000000000000,265.00000000000000000000],[0.00003545000000000000,7657.00000000000000000000,4.00000000000000000000],[0.00003549000000000000,7969.00000000000000000000,312.00000000000000000000],[0.00003600000000000000,9550.00000000000000000000,1581.00000000000000000000],[0.00003672000000000000,9588.00000000000000000000,38.00000000000000000000],[0.00003688000000000000,9755.00000000000000000000,167.00000000000000000000],[0.00003700000000000000,13843.00000000000000000000,4088.00000000000000000000],[0.00003726000000000000,13999.00000000000000000000,156.00000000000000000000],[0.00003750000000000000,14386.00000000000000000000,387.00000000000000000000],[0.00003777000000000000,14389.00000000000000000000,3.00000000000000000000],[0.00003780000000000000,14845.00000000000000000000,456.00000000000000000000],[0.00003788000000000000,15157.00000000000000000000,312.00000000000000000000],[0.00003789000000000000,17267.00000000000000000000,2110.00000000000000000000],[0.00003790000000000000,17362.00000000000000000000,95.00000000000000000000],[0.00003800000000000000,17808.00000000000000000000,446.00000000000000000000],[0.00003869000000000000,18170.00000000000000000000,362.00000000000000000000],[0.00003886000000000000,18544.00000000000000000000,374.00000000000000000000],[0.00003890000000000000,19527.00000000000000000000,983.00000000000000000000],[0.00003899000000000000,19536.00000000000000000000,9.00000000000000000000],[0.00003900000000000000,19958.00000000000000000000,422.00000000000000000000],[0.00003928000000000000,19963.00000000000000000000,5.00000000000000000000],[0.00003940000000000000,24191.00000000000000000000,4228.00000000000000000000],[0.00003948000000000000,26195.00000000000000000000,2004.00000000000000000000],[0.00003949000000000000,26237.00000000000000000000,42.00000000000000000000]]]"
        3) "sell"
        4) "[[0.00003111000000000000,87.00000000000000000000],[0.00003112000000000000,89.00000000000000000000],[0.00003114000000000000,1748.00000000000000000000],[0.00003115000000000000,28.00000000000000000000],[0.00003127000000000000,2.00000000000000000000],[0.00003160000000000000,10.00000000000000000000],[0.00003170000000000000,11.00000000000000000000],[0.00003250000000000000,2854.00000000000000000000],[0.00003278000000000000,320.00000000000000000000],[0.00003300000000000000,26.00000000000000000000],[0.00003310000000000000,679.00000000000000000000],[0.00003399000000000000,5.00000000000000000000],[0.00003415000000000000,165.00000000000000000000],[0.00003449000000000000,42.00000000000000000000],[0.00003450000000000000,177.00000000000000000000],[0.00003492000000000000,1145.00000000000000000000],[0.00003500000000000000,265.00000000000000000000],[0.00003545000000000000,4.00000000000000000000],[0.00003549000000000000,312.00000000000000000000],[0.00003600000000000000,1581.00000000000000000000],[0.00003672000000000000,38.00000000000000000000],[0.00003688000000000000,167.00000000000000000000],[0.00003700000000000000,4088.00000000000000000000],[0.00003726000000000000,156.00000000000000000000],[0.00003750000000000000,387.00000000000000000000],[0.00003777000000000000,3.00000000000000000000],[0.00003780000000000000,456.00000000000000000000],[0.00003788000000000000,312.00000000000000000000],[0.00003789000000000000,2110.00000000000000000000],[0.00003790000000000000,95.00000000000000000000],[0.00003800000000000000,446.00000000000000000000],[0.00003869000000000000,362.00000000000000000000],[0.00003886000000000000,374.00000000000000000000],[0.00003890000000000000,983.00000000000000000000],[0.00003899000000000000,9.00000000000000000000],[0.00003900000000000000,422.00000000000000000000],[0.00003928000000000000,5.00000000000000000000],[0.00003940000000000000,4228.00000000000000000000],[0.00003948000000000000,2004.00000000000000000000],[0.00003949000000000000,42.00000000000000000000]]"
        5) "buy"
        6) "[[0.00003024000000000000,3848.00000000000000000000],[0.00003022000000000000,5.00000000000000000000],[0.00003021000000000000,626.00000000000000000000],[0.00003010000000000000,262.00000000000000000000],[0.00003006000000000000,263.00000000000000000000],[0.00003000000000000000,740.00000000000000000000],[0.00002987000000000000,61.00000000000000000000],[0.00002961000000000000,1383.00000000000000000000],[0.00002960000000000000,118.00000000000000000000],[0.00002900000000000000,1360.00000000000000000000],[0.00002898000000000000,691.00000000000000000000],[0.00002852000000000000,627.00000000000000000000],[0.00002850000000000000,174.00000000000000000000],[0.00002810000000000000,123.00000000000000000000],[0.00002770000000000000,493.00000000000000000000],[0.00002756000000000000,1238.00000000000000000000],[0.00002700000000000000,1.00000000000000000000],[0.00002673000000000000,1.00000000000000000000],[0.00002660000000000000,244.00000000000000000000],[0.00002601000000000000,1.00000000000000000000],[0.00002600000000000000,1.00000000000000000000],[0.00002545000000000000,1.00000000000000000000],[0.00002538000000000000,161.00000000000000000000],[0.00002513000000000000,2.00000000000000000000],[0.00002501000000000000,20.00000000000000000000],[0.00002500000000000000,48.00000000000000000000],[0.00002400000000000000,7.00000000000000000000],[0.00002356000000000000,733.00000000000000000000],[0.00002333000000000000,1.00000000000000000000],[0.00002331000000000000,20.00000000000000000000],[0.00002323000000000000,6.00000000000000000000],[0.00002300000000000000,101.00000000000000000000],[0.00002295000000000000,10.00000000000000000000],[0.00002270000000000000,37.00000000000000000000],[0.00002206000000000000,1.00000000000000000000],[0.00002201000000000000,2.00000000000000000000],[0.00002200000000000000,1.00000000000000000000],[0.00002196000000000000,57.00000000000000000000],[0.00002170000000000000,580.00000000000000000000],[0.00002144000000000000,1.00000000000000000000],[0.00002100000000000000,34.00000000000000000000],[0.00002062000000000000,234.00000000000000000000]]"

- K线数据
    
    key: <计价币种>_<交易币种>:kline

    类型： hash

        > hgetall BTC_ACT:kline
         1) "1d"
         2) "[{\"amount\":66971.90070000000000000000,\"close\":0.00003036000000000000,\"klineType\":\"DAY\",\"lowPrice\":0.00003028000000000000,\"maxPrice\":0.00003133000000000000,\"open\":0.00003108000000000000,\"symbol\":\"BTC_ACT\",\"time\":1524805200},{\"amount\":443813.34190000000000000000,\"close\":0.00003119000000000000,\"klineType\":\"DAY\",\"lowPrice\":0.00003058000000000000,\"maxPrice\":0.00003278000000000000,\"open\":0.00003138000000000000,\"symbol\":\"BTC_ACT\",\"time\":1524718800},{\"amount\":181176.74950000000000000000,\"close\":0.00003140000000000000,\"klineType\":\"DAY\",\"lowPrice\":0.00002960000000000000,\"maxPrice\":0.00003190000000000000,\"open\":0.00002988000000000000,\"symbol\":\"BTC_ACT\",\"time\":1524632400}]"
         3) "15m"
         4) "[...]"
         5) "1m"
         6) "[...]"
         7) "1h"
         8) "[...]"
         9) "5m"
        10) "[...]"
        11) "30m"
        12) "[...]"

- 成交记录

    key: <计价币种>_<交易币种>:orderd

    类型： list

        > lrange BTC_ACT:orderd 0 3
        1) "{\"num\":266.52310000000000000000,\"price\":0.00003028000000000000,\"time\":\"1524818293\",\"type\":\"BUY\"}"
        2) "{\"num\":133.26150000000000000000,\"price\":0.00003028000000000000,\"time\":\"1524818289\",\"type\":\"SELL\"}"
        3) "{\"num\":370.80320000000000000000,\"price\":0.00003054000000000000,\"time\":\"1524818242\",\"type\":\"BUY\"}"
        4) "{\"num\":185.40160000000000000000,\"price\":0.00003054000000000000,\"time\":\"1524818237\",\"type\":\"BUY\"}"

- 24Hours Price

    key: detail_symbol
    
    类型： hash

        > hgetall detail_symbol
        1) "ETH_EOS"
        2) "{\"24Total\":\"63410.81950000000000000000\",\"24Price\":\"0.02345800000000000000\",\"24high\":\"0.02380746000000000000\",\"24low\":\"0.02262100000000000000\"}"
        3) "BTC_ACT"
        4) "{\"24Total\":\"453159.16270000000000000000\",\"24Price\":\"0.00003130000000000000\",\"24high\":\"0.00003278000000000000\",\"24low\":\"0.00003026000000000000\"}"
        

